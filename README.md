اعتبار سنجی و تایید هویت درخواست ها:
برای اعتبارسنجی درخواست هایی که منجر به پرداخت می شوند از روش HMAC استفاده شده است.

برای ساخت HMAC نیاز است که یک AppId و ApiKey دریافت نمایید. ساختار کلید HMAC بصورت زیر می باشد:

| **عنوان**        | **نام**         | **توضیحات**                   | **نمونه**                            |
|------------------|-----------------|-------------------------------|-------------------------------------|
| **پیشوند**       | hmacauth        |                               | hmacauth                            |
| **جداکننده**     | خط فاصله        |                               |                                     |
| **بخش 1**        | AppId           |                               | 8c8b3017-e88a-4ef4-941b-4b68229c2b45 |
| **جدا کننده**    | :               |                               |                                     |
| **بخش 2**        | امضای درخواست   | در ادامه تشریح خواهد شد      | 346mUl60B9PavQ2TXycO6M2/CFzm4ToQtaCnJRAX0Yc= |
| **جدا کننده**    | :               |                               |                                     |
| **بخش 3**        | Nonce           | یک مقدار تصادفی              | 3a5ded246b7e483a942262bd882a579f   |
| **جدا کننده**    | :               |                               |                                     |
| **بخش 4**        | Unix time       |                               | 1718797891                          |


مقدار نهایی به شرح ذیل است:

hmacauth 8c8b3017-e88a-4ef4-941b-4b68229c2b45:346mUl60B9PavQ2TXycO6M2/CFzm4ToQtaCnJRAX0Yc=:3a5ded246b7e483a942262bd882a579f:1718797891


برای ساخت کلید HMAC نیاز است که 4 بخش تعیین شده در جدول فوق را داشته باشیم. جز بخش 2 سایر بخش ها در همان جدول مشخص شده اند.

برای ساخت بخش 2 (امضای درخواست) از جدول فوق به موارد زیر نیاز خواهیم داشت:

| **نام**         | **AppId**                               | **ApiKey** | **Resource Url**                                      | **HTTP Method** | **Nonce**                             | **Unix time** | **Request Body**                          |
|------------------|-----------------------------------------|------------|-------------------------------------------------------|-----------------|---------------------------------------|---------------|-------------------------------------------|
| **نمونه**        | `8c8b3017-e88a-4ef4-941b-4b68229c2b45` | MRIuMOU9   | `%2Fapi%2Fv1%2Fwithdraw%2Fwallet%2F1%2Fbill`       | POST            | `212dec30b3a447f88e21b35691a1665a`   | `1718798796`  | `{"ClientRequestId":"3088","Amount":"10000"}` |
| **توضیحات**      | دریافت از مدیر سیستم                   | دریافت از مدیر سیستم | Encode Uri of (/api/v1/Withdraw/wallet/1/bill | UpperCase       | UUID                                  |               | Json of request object                    |

بعد از آماده سازی اطلاعات مورد نیاز برای ساخت امضای درخواست میتوانیم با طی مراحل زیر امضای درخواست را بسازیم:

1- ساخت SHA1 از Request Body
2- تبدیل خروجی مرحله قبل (1) به Base642
3- تولید یک رشته از ترکیب زیر بدون جداکننده


| **عنوان**      | **نام**        | **توضیحات**       | **نمونه**                                       |
|-----------------|----------------|--------------------|-------------------------------------------------|
| بخش 1           | AppId          |                    | `8c8b3017-e88a-4ef4-941b-4b68229c2b45`        |
| بخش 2           | HttpMethod     |                    | POST                                            |
| بخش 3           | Resource Url   |                    | `%2Fapi%2Fv1%2Fwithdraw%2Fwallet%2F1%2Fbill`  |
| بخش 4           | Unix time      |                    | 1718798796                                     |
| بخش 5           | Nonce          |                    | `212dec30b3a447f88e21b35691a1665a`            |
| بخش 6           | Body Base64    | خروجی مرحله 2      | BbT1gmw+NBrp3YKBY740uldawqw=                   |




4- هش خروجی مرحله قبل با استفاده از secret(ApiKey) - امین تکمیل کند
